apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: clone
  namespace: default
spec:
  steps:
    - name: clone
      image: ubuntu
      command:
        - echo
      args:
        - "clone"
---
apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: assemble-and-push
  namespace: default
spec:
  steps:
    - name: assemble-and-push
      image: ubuntu
      command:
        - echo
      args:
        - "assemble-and-push"        
---
apiVersion: tekton.dev/v1beta1
kind: Pipeline
metadata:
  name: build-and-push-microservice-on-pr
  namespace: default
spec:
  workspaces:
    - name: workspace
  params:
    - name: repo-url
      type: string    
    - name: branch-name
      type: string
      description: The git branch to clone.    
    - name: imageLocation
      description: Location where the resulting docker image will be pushed to
      type: string
  tasks:
    - name: clone
      taskRef:
        name: clone
        kind: Task
    - name: assemble-and-push
      taskRef:
        name: assemble-and-push
        kind: Task
      runAfter:
        - clone
---
apiVersion: pipeline.jquad.rocks/v1alpha1
kind: PipelineTrigger
metadata:
  name: pipelinetrigger-for-pr
  namespace: default
spec:
  source: 
    kind: PullRequest
    name: pullrequest-bitbucket-sample
  pipeline: 
    name: build-and-push-microservice-on-pr
    serviceAccountName: default
    maxHistory: 3
    maxFailedRetries: 2 
    securityContext:
      runAsUser: 1001
      runAsGroup: 1001
      fsGroup: 1001
    workspace:
      name: workspace
      size: 1Gi
      accessMode: ReadWriteOnce
    inputParams:
      - name: "repo-url"
        value: "https://github.com/jquad-group/microservice.git"
      - name: "branch-name"
        value: $.fromRef.blabla
      - name: "commitid"
        value: "234w3q4lsammsk3134158"
      - name: "imageLocation"
        value: "docker.io/org/image"